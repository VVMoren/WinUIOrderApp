<Page x:Class="WinUIOrderApp.Views.Pages.DataPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:local="clr-namespace:WinUIOrderApp.Views.Pages"
      mc:Ignorable="d"
      d:DesignHeight="450" d:DesignWidth="800"
      Title="DataPage">

    <Page.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
    </Page.Resources>

    <Grid Background="#1F1F1F" Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <StackPanel Orientation="Horizontal" Margin="12,12,12,8" VerticalAlignment="Center">
            <Button Content="Свод по имени"
                    Command="{Binding ShowSummaryCommand}"
                    Margin="0,0,12,0"
                    Padding="16,6"/>
            <Button Content="Фильтры"
                    Command="{Binding ToggleFiltersCommand}"
                    Padding="16,6"/>
            <TextBlock Text="{Binding StatusMessage}"
                       Foreground="White"
                       Margin="24,0,0,0"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <Border Grid.Row="1"
                Background="#252525"
                BorderBrush="#333"
                BorderThickness="1"
                CornerRadius="4"
                Margin="12,0,12,12"
                Padding="12"
                Visibility="{Binding IsFilterPanelVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <WrapPanel Orientation="Horizontal" ItemWidth="220" ItemHeight="70">
                <StackPanel Width="220">
                    <TextBlock Text="Наименование" Foreground="#FFB0B0B0" Margin="0,0,0,4"/>
                    <ComboBox ItemsSource="{Binding AvailableNames}"
                              SelectedItem="{Binding SelectedName, Mode=TwoWay}"
                              Background="#2D2D2D"
                              Foreground="White"/>
                </StackPanel>
                <StackPanel Width="220">
                    <TextBlock Text="GTIN" Foreground="#FFB0B0B0" Margin="12,0,0,4"/>
                    <ComboBox ItemsSource="{Binding AvailableGtins}"
                              SelectedItem="{Binding SelectedGtin, Mode=TwoWay}"
                              Background="#2D2D2D"
                              Foreground="White"/>
                </StackPanel>
                <StackPanel Width="220">
                    <TextBlock Text="Криптохвост" Foreground="#FFB0B0B0" Margin="12,0,0,4"/>
                    <ComboBox ItemsSource="{Binding AvailableCryptoStatuses}"
                              SelectedItem="{Binding SelectedCryptoStatus, Mode=TwoWay}"
                              Background="#2D2D2D"
                              Foreground="White"/>
                </StackPanel>
            </WrapPanel>
        </Border>

        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding FilteredCodes}"
                  AutoGenerateColumns="False"
                  Margin="12"
                  HeadersVisibility="Column"
                  RowBackground="#252525"
                  AlternatingRowBackground="#303030"
                  Foreground="White"
                  Background="#1F1F1F"
                  GridLinesVisibility="Horizontal"
                  IsReadOnly="True">
            <DataGrid.Columns>
                <DataGridTextColumn Header="КИ" Binding="{Binding Ki}" Width="*"/>
                <DataGridTextColumn Header="Полный КМ" Binding="{Binding FullCode}" Width="2*"/>
                <DataGridTextColumn Header="GTIN" Binding="{Binding Gtin}" Width="*"/>
                <DataGridTextColumn Header="Наименование" Binding="{Binding ProductName}" Width="2*"/>
                <DataGridTextColumn Header="Статус криптохвоста" Binding="{Binding CryptoStatus}" Width="*"/>
                <DataGridTextColumn Header="Бренд" Binding="{Binding Brand}" Width="*"/>
            </DataGrid.Columns>
        </DataGrid>

        <Border Grid.Row="3"
                Margin="12,0,12,12"
                Padding="12"
                Background="#252525"
                BorderBrush="#333"
                BorderThickness="1"
                CornerRadius="4"
                Visibility="{Binding IsSummaryVisible, Converter={StaticResource BoolToVisibilityConverter}}">
            <ItemsControl ItemsSource="{Binding SummaryEntries}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                            <TextBlock Text="{Binding Name}" Foreground="White" Width="300"/>
                            <TextBlock Text="{Binding Count}" Foreground="#FFB0B0B0"/>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>

        <Button Grid.Row="4"
                Content="Сохранить как"
                Command="{Binding SaveAsCommand}"
                HorizontalAlignment="Left"
                Margin="12,0,0,12"
                Padding="16,6"/>
    </Grid>
</Page>
