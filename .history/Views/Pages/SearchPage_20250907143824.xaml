<Page
    x:Class="markapp.Views.Pages.SearchPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    d:DesignWidth="1200" d:DesignHeight="800"
    Title="SearchPage">

    <Page.Resources>
        <!-- Конвертер для отображения progress bar -->
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    </Page.Resources>

    <!-- Верхняя «панелька» как на скриншоте -->
    <Grid Background="#141418">
        <Grid.RowDefinitions>
            <RowDefinition Height="90"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Top Controls -->
        <Grid Grid.Row="0" Margin="80,25,80,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="4"/>
                <!-- высота полосы прогресса -->
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="1.5*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- TextBox -->
            <ui:TextBox
                Margin="0,0,16,0"
                FontSize="12" FontWeight="Bold"
                Height="30"
                PlaceholderText="Введите запрос"
                Text="{Binding QueryText, UpdateSourceTrigger=PropertyChanged}"
                IsEnabled="{Binding IsNotBusy}"/>

            <!-- ComboBox -->
            <ComboBox
                Grid.Column="1"
                Height="30"
                Margin="0,0,16,0"
                ItemsSource="{Binding Modes}"
                SelectedItem="{Binding SelectedMode}"
                DisplayMemberPath="Title"
                IsEnabled="{Binding IsNotBusy}" FontSize="12"/>

            <!-- Button -->
            <ui:Button
                Grid.Column="2"
                Height="30" MinWidth="90"
                Content="Поиск"
                Command="{Binding SearchCommand}"
                IsEnabled="{Binding IsNotBusy}"/>

            <!-- ProgressBar -->
            <ProgressBar Grid.Row="1"
                         Grid.ColumnSpan="3"
                         Height="4"
                         Minimum="0"
                         Maximum="100"
                         Value="{Binding Progress}"
                         Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}"
                         Foreground="#0078D7"
                         Background="#2A2A2A"/>
        </Grid>

        <!-- DataGrid (как на скриншоте: чекбокс, № и динамические столбцы) -->
        <DataGrid x:Name="DataGrid"
                  Grid.Row="1"
                  Margin="80,10,80,40"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  HeadersVisibility="Column"
                  SelectionMode="Single"
                  CanUserResizeRows="False"
                  AlternationCount="10000"
                  ItemsSource="{Binding Rows}"
                  Background="#1A1A1A"
                  Foreground="White"
                  BorderBrush="Transparent"
                  RowBackground="#212121"
                  AlternatingRowBackground="#1C1C1C" Cursor="">

            <!-- Обёртка строки с закруглением (как у вас в шаблоне) -->
            <DataGrid.RowStyle>
                <Style TargetType="DataGridRow">
                    <Setter Property="Margin" Value="0,4,0,4"/>
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="DataGridRow">
                                <Border CornerRadius="12"
                                        Background="{TemplateBinding Background}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        BorderThickness="0">
                                    <SelectiveScrollingGrid>
                                        <SelectiveScrollingGrid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </SelectiveScrollingGrid.ColumnDefinitions>
                                        <SelectiveScrollingGrid.RowDefinitions>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </SelectiveScrollingGrid.RowDefinitions>

                                        <DataGridCellsPresenter Grid.Column="1"/>
                                        <DataGridDetailsPresenter Grid.Row="1" Grid.Column="1"
                                                                  Visibility="{TemplateBinding DetailsVisibility}"/>
                                        <DataGridRowHeader Grid.RowSpan="2"
                                                           SelectiveScrollingGrid.SelectiveScrollingOrientation="Vertical"/>
                                    </SelectiveScrollingGrid>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </DataGrid.RowStyle>

            <DataGrid.Columns>
                <!-- ☑ -->
                <DataGridTemplateColumn Width="40" Header="☑️">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <CheckBox IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                      HorizontalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>

                <!-- № -->
                <DataGridTextColumn Header="№" Width="40"
                    Binding="{Binding RelativeSource={RelativeSource AncestorType=DataGridRow}, Path=(ItemsControl.AlternationIndex)}"/>
            </DataGrid.Columns>
        </DataGrid>
    </Grid>
</Page>
